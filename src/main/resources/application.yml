spring:
  profiles:
    active: dev
  main:
    web-application-type: none  # 禁用 Spring Boot 嵌入式 Web 服务器，使用自定义 Netty

# Gateway Configuration
gateway:
  server:
    port: 8080
    netty:
      boss-threads: 1
      worker-threads: 0  # 0 means Netty auto-calculates based on CPU cores

  # Security Configuration
  security:
    ip-whitelist:
      enabled: true
      list:
        - 127.0.0.1
        - 0:0:0:0:0:0:0:1
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
    auth:
      enabled: true
      skip-paths:
        - /public/**
        - /health
        - /actuator/**
        - /favicon.ico
      auth-server-url: https://auth.example.com/validate
      timeout-ms: 500

  # Rate Limiting Configuration
  rate-limit:
    enabled: true
    algorithm: token-bucket  # token-bucket | leaky-bucket
    capacity: 100
    refill-tokens: 100
    refill-period-seconds: 60
    per-client:
      enabled: true

  # Circuit Breaker Configuration
  circuit-breaker:
    enabled: true
    failure-rate-threshold: 50
    wait-duration-open-state-seconds: 30
    sliding-window-size: 20
    slow-call-duration-threshold-ms: 2000
    slow-call-rate-threshold: 80
    minimum-number-of-calls: 10

# Logging Configuration
logging:
  level:
    root: INFO
    com.gateway: DEBUG
    io.netty: WARN
    reactor.netty: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] [%X{traceId}] %-5level %logger{36} - %msg%n"

# Actuator 配置已禁用（使用自定义 Netty 服务器，不启用 Spring Boot WebFlux）
# 健康检查通过自定义 /health 端点提供

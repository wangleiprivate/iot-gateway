# 统一网关详细设计

## 需求
### 背景
统一网关（Gateway）项目是一个基于 **Netty + Spring Boot + Spring Cloud Alibaba + Nacos** 的高性能 API 网关，用于统一处理所有进入系统的 HTTP 请求，实现：

- 请求路由转发
- 白名单校验
- 权限校验
- 限流（漏桶算法）
- 熔断机制
- 统一配置（Nacos + 本地 yml）
- 异步高吞吐量处理（基于 Netty）
### 详细需求描述
#### 步骤一: 基于netty的异步处理请求
#### 步骤二: 处理请求,先从 Nacos配置文件读取IP白名单,看请求过来的IP是否在白名单内，不再白名单，返回非法请求，在白名单则继续下一步
#### 步骤三: 查看该转发的接口是否需要校验权限(也是通过请求路径启匹配yml里面的配置的文地址列表)，如果不需要则进行步骤五，需要则进行步骤四
#### 步骤四：去第三方认证token或者Authorization，不通过则返回认证失败，请重新认证
#### 步骤五：进行HTTP的GET或者POST请求转发和响应返回


### 功能点
####  基于netty的异步请求,增加吞吐量
### 漏桶算法限量 , 数量在Nacos进行配置
### 增加熔断机制,接口超时进行熔断
### 
## 技术栈
### JDK17
### Nacos 地址是：http://61.134.69.50:8848/nacos，已经有了nacos，不需要在项目里面启动
### netty
### SpringCloud
### SpringCloud-Alibaba 2025.0.0.0
### spring-boot 3.5.9-SNAPSHOT
### 
| 类型 | 技术选型 |
|------|----------|
| JDK | JDK 17 |
| 网络框架 | Netty |
| Web/MicroService | Spring Boot 3.5.9-SNAPSHOT |
| 微服务套件 | Spring Cloud |
| Alibaba 生态 | Spring Cloud Alibaba 2025.0.0.0 |
| 配置中心 | Nacos |
| 构建工具 | Maven |
| 部署环境 | Docker |

## 3. 详细需求说明
1. 基于 Netty 的异步接入层  
2. 白名单校验（Nacos > yml fallback）  
3. 权限校验（可配置路径）  
4. HTTP 请求转发（GET/POST）  
5. 限流（漏桶算法）与熔断机制  

## 4. 功能列表
- Netty 请求接入  
- IP 白名单校验  
- 权限及 Token 校验  
- 请求转发  
- 熔断与限流  
- 统一配置管理  
- Docker 部署  

## 5. 配置文件设计
所有配置均必须放在 yml 文件中，且优先从 Nacos 读取。

## 6. 验收标准
- Maven 编译通过  
- 启动端口为 8080  
- 能正常执行白名单、鉴权、限流、熔断和转发
-

``` XML
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>open.source.test</groupId>
    <artifactId>nacos-discovery-test</artifactId>
    <version>1.0-SNAPSHOT</version>
    <name>nacos-discovery-test</name>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>${spring.boot.version}</version>
        <relativePath/>
    </parent>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
        <java.version>1.8</java.version>
    </properties>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring.cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${spring.cloud.alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

```SQL
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-alibaba-dependencies</artifactId>
            <version>2.2.9.RELEASE</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>


 <dependency>
            <groupId>io.netty</groupId>
            <artifactId>netty-all</artifactId>
            <version>4.1.6.Final</version>
        </dependency>
```
### 

## 要求
### 所有都必须配置在配置文件里面
### 只能有一个springBoot启动类
### 不能使用properties文件，配置文件都是yml，yml文件首先从Nacos取读，读取不到读取本地的Nacos
### docker容器启动, 本地通过springboot启动类也可以启动
### 白名单，Nacos连接地址，是否需要权限校验列表，等都必须在yml文件里面配置
### 区分 prod环境和dev环境

## 验收标准
### 可以正常maven编译通过
### 可以直接运行，端口是8080

